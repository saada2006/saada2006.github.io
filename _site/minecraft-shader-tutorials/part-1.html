<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Part 1 - The Final Program - Saad’s blog</title>
<meta name="description" content="In this tutorial we explore the most basic fullscreen pass, known as the final pass.">


  <meta name="author" content="Saad Amin">
  
  <meta property="article:author" content="Saad Amin">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Saad's blog">
<meta property="og:title" content="Part 1 - The Final Program">
<meta property="og:url" content="http://localhost:4000/minecraft-shader-tutorials/part-1">


  <meta property="og:description" content="In this tutorial we explore the most basic fullscreen pass, known as the final pass.">



  <meta property="og:image" content="http://localhost:4000/assets/images/mc_shaders_part1/demo.png">





  <meta property="article:published_time" content="2023-02-14T22:09:13-08:00">






<link rel="canonical" href="http://localhost:4000/minecraft-shader-tutorials/part-1">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Saad's blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          processEscapes: true
        }
      });
      </script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Home
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/minecraft-shader-tutorials/">Minecraft Shader Tutorials</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">Personal</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style="background-color: #000; background-image: linear-gradient(rgba(0, 0, 0, 0.24), rgba(0, 0, 0, 0.24)), url('/assets/images/mc_shaders_part1/demo.png');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          Part 1 - The Final Program

        
      </h1>
      
        <p class="page__lead">In this tutorial we explore the most basic fullscreen pass, known as the final pass.
</p>
      
      


      
      
    </div>
  
  
</div>







<div id="main" role="main">
  


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Part 1 - The Final Program">
    <meta itemprop="description" content="In this tutorial we explore the most basic fullscreen pass, known as the final pass.">
    
    

    <div class="page__inner-wrap">
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> Table of Contents</h4></header>
              <ul class="toc__menu"><li><a href="#basic-file-structure-of-a-shader">Basic file structure of a shader</a></li><li><a href="#what-is-final">What is final?</a></li><li><a href="#what-other-fullscreen-passes-are-there">What other fullscreen passes are there?</a></li><li><a href="#show-me-the-code">Show me the code</a></li></ul>

            </nav>
          </aside>
        
        <h1 id="basic-file-structure-of-a-shader">Basic file structure of a shader</h1>

<p>Before we start learning about <code class="language-plaintext highlighter-rouge">final</code>, we need to understand the basic file structure of a shader pack. Within a shader pack, there is a folder called “shaders”. This is where all the shader files goes. The files have the extension <code class="language-plaintext highlighter-rouge">.vsh</code> for vertex shaders or <code class="language-plaintext highlighter-rouge">.fsh</code> for fragment shaders. The shader file name corresponds to a shader program name. For example, <code class="language-plaintext highlighter-rouge">final.vsh</code> and <code class="language-plaintext highlighter-rouge">final.fsh</code> are part of the <code class="language-plaintext highlighter-rouge">final</code> shader program.</p>

<p>To create your own shader, first create a folder. The name of the folder is the name you want to give your shader. Then inside that folder, create another folder called “shaders”. Within <code class="language-plaintext highlighter-rouge">shaders</code>, you can start creating the shader files. If you are confused about file structure of a shader pack, you can always look at another shader pack for reference.</p>

<h1 id="what-is-final">What is final?</h1>

<p>final is a fullscreen pass. It is the last pass in the shader pipeline. Whatever color final outputs is the color that gets displayed on your screen. Here, you can do certain post processing effects like bluring, tone mapping, or gamma correction.</p>

<h1 id="what-other-fullscreen-passes-are-there">What other fullscreen passes are there?</h1>

<p>In Optifine, there are 3 types of fullscreen passes. They are called <code class="language-plaintext highlighter-rouge">deferred</code>, <code class="language-plaintext highlighter-rouge">composite</code>, and <code class="language-plaintext highlighter-rouge">final</code>. <code class="language-plaintext highlighter-rouge">final</code> is the fullscreen pass we just covered. <code class="language-plaintext highlighter-rouge">deferred</code> and <code class="language-plaintext highlighter-rouge">compsite</code> are fullscreen passes we will cover in later tutorials.</p>

<h1 id="show-me-the-code">Show me the code</h1>

<p>We will be implementing a basic shader that converts the colors on your screen to grayscale. Let’s start off with the vertex shader. We first start with the version declratation. We will be using GLSL version 120</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 120
</span></code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">final</code> is a fullscreen pass, we need to pass a texture coordinate into the fragment shader so we can read from the pixels from the screen.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">varying</span> <span class="kt">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</code></pre></div></div>

<p>Now we head into the <code class="language-plaintext highlighter-rouge">main</code> function of the vertex shader.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">ftransform</span><span class="p">();</span>
   <span class="n">TexCoords</span> <span class="o">=</span> <span class="n">gl_MultiTexCoord0</span><span class="p">.</span><span class="n">st</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you have never seen <code class="language-plaintext highlighter-rouge">ftransform</code> or <code class="language-plaintext highlighter-rouge">gl_MultiTexCoord0</code> before, don’t worry. They are part of the old versions of the GLSL shading language. <code class="language-plaintext highlighter-rouge">ftransform</code> basically expands to <code class="language-plaintext highlighter-rouge">gl_ModelViewProjectionMatrix * gl_Vertex</code>. <code class="language-plaintext highlighter-rouge">gl_Vertex</code> is the in-built vertex attribute.<code class="language-plaintext highlighter-rouge">gl_ModelViewProjectionMatrix</code> is the in-build model view projection matrix. Since <code class="language-plaintext highlighter-rouge">gl_Vertex</code> is probably in clip space already, <code class="language-plaintext highlighter-rouge">gl_ModelViewProjectionMatrix</code> is the identity matrix. <code class="language-plaintext highlighter-rouge">gl_MultiTexCoord0</code> is the in-built texture coordinate attribute. If you are wondering, yes, there is <code class="language-plaintext highlighter-rouge">gl_MultiTexCoord1</code>, <code class="language-plaintext highlighter-rouge">gl_MultiTexCoord2</code>, etc. We will look into using <code class="language-plaintext highlighter-rouge">gl_MultiTexCoord1</code> later. <code class="language-plaintext highlighter-rouge">gl_MultiTexCoord2</code> and higher are usually not used. In built texture coordinates are <code class="language-plaintext highlighter-rouge">vec4</code>, which is why we have to add <code class="language-plaintext highlighter-rouge">.st</code> at the end.</p>

<p>End the end your vertex shader looks like this:</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 120
</span>
<span class="k">varying</span> <span class="kt">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="nb">gl_Position</span> <span class="o">=</span> <span class="n">ftransform</span><span class="p">();</span>
   <span class="n">TexCoords</span> <span class="o">=</span> <span class="n">gl_MultiTexCoord0</span><span class="p">.</span><span class="n">st</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>After the vertex shader comes the fragment shader. We start off by declaring the GLSL version and accepting the texture coordinate output from the vertex shader.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 120
</span>
<span class="k">varying</span> <span class="kt">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</code></pre></div></div>

<p>Since final is a fullscreen pass, we need to sample the screen’s color from somewhere. Since we have not defined any other program besides final, Optifine will use it’s internal shader for the missing programs. The internal shader is basically a reimplementation of the vanilla shaders in the shader pipeline. The internal shaders outputs it’s color to a texture called <code class="language-plaintext highlighter-rouge">colortex0</code>.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">uniform</span> <span class="kt">sampler2D</span> <span class="n">colortex0</span><span class="p">;</span>
</code></pre></div></div>

<p>Now we enter the <code class="language-plaintext highlighter-rouge">main</code> function:</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Sample the color</span>
   <span class="kt">vec3</span> <span class="n">Color</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">colortex0</span><span class="p">,</span> <span class="n">TexCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
   <span class="c1">// Convert to grayscale</span>
   <span class="n">Color</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">333</span><span class="n">f</span><span class="p">)));</span>
   <span class="c1">// Output the color</span>
   <span class="nb">gl_FragColor</span> <span class="o">=</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Let’s break it down line by line. We first sample <code class="language-plaintext highlighter-rouge">colortex0</code> using our texture coordinate. We use the function <code class="language-plaintext highlighter-rouge">texture2D</code> here since that is how you sampled from a 2D texture in old versions of GLSL. More modern versions have replaced this function with <code class="language-plaintext highlighter-rouge">texture</code>, however, that is not available in GLSL 120. We then convert the color to grayscale using <code class="language-plaintext highlighter-rouge">dot(Color, vec3(0.333f))</code> which is mathematically equivalent to <code class="language-plaintext highlighter-rouge">Color.r * 0.333f + Color.g * 0.333f + Color.b * 0.333f</code>. Then we finally output the color to <code class="language-plaintext highlighter-rouge">gl_FragColor</code>.</p>

<p>In the end, your fragment shader should be this:</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#version 120
</span>
<span class="k">varying</span> <span class="kt">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>

<span class="k">uniform</span> <span class="kt">sampler2D</span> <span class="n">colortex0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="c1">// Sample the color</span>
   <span class="kt">vec3</span> <span class="n">Color</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">colortex0</span><span class="p">,</span> <span class="n">TexCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
   <span class="c1">// Convert to grayscale</span>
   <span class="n">Color</span> <span class="o">=</span> <span class="kt">vec3</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="kt">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">333</span><span class="n">f</span><span class="p">)));</span>
   <span class="c1">// Output the color</span>
   <span class="nb">gl_FragColor</span> <span class="o">=</span> <span class="kt">vec4</span><span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here is the results of the shader:</p>

<p><img src="/assets/images/mc_shaders_part1/demo.png" alt="Image of the Grayscale Shader" /></p>

<p>Although it is not much, it’s definitely a start on your shader programming journey! In the next tutorial, we will do some block rendering and learn about <code class="language-plaintext highlighter-rouge">composite</code>, which is the other fullscreen pass I mentioned.</p>

        
      </section>

      <footer class="page__meta">
        
        


        

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/minecraft-shader-tutorials/part-0" class="pagination--pager" title="Part 0 - Introduction
">Previous</a>
    
    
      <a href="/minecraft-shader-tutorials/part-2" class="pagination--pager" title="Part 2 - The Gbuffers Programs
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Saad's blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
  
</html>
